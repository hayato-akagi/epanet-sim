# Water Distribution Control System Simulation

EPANETã‚’ç”¨ã„ãŸæ°´ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã€å¤–éƒ¨ã®Pythonãƒ™ãƒ¼ã‚¹ã®åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆPIDã€MPCã€VLAï¼‰ã‚’ç–Žçµåˆã§é€£æºã•ã›ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åŸºç›¤ã§ã™ã€‚Docker Composeä¸Šã§å‹•ä½œã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«è¿‘ã„ã€ŒSense-Decide-Actuateã€ãƒ«ãƒ¼ãƒ—ã‚’å†ç¾ã—ã¾ã™ã€‚

## ä¸»ãªç‰¹å¾´

- âœ… **è¤‡æ•°ã®åˆ¶å¾¡æ‰‹æ³•**: PIDã€MPCã€VLA (Vision-Language-Action)
- âœ… **åœ§åŠ›åˆ¶å¾¡ãƒ»æµé‡åˆ¶å¾¡ã®ä¸¡å¯¾å¿œ**
- âœ… **å˜ä¸€ãƒ«ãƒ¼ãƒ—ãƒ»è¤‡æ•°ãƒ«ãƒ¼ãƒ—ï¼ˆåˆ†æ•£åˆ¶å¾¡ï¼‰ã®ä¸¡å¯¾å¿œ**
- âœ… **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§èƒ½è©•ä¾¡ã¨3Då¯è¦–åŒ–**
- âœ… **ç”»åƒãƒ™ãƒ¼ã‚¹ã®å¼·åŒ–å­¦ç¿’å¯¾å¿œ**ï¼ˆVLAã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ï¼‰
- âœ… **è‡ªå‹•ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®—ã¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ­ã‚°**

---

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š

### ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹

1. **sim-runner** - EPANETã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿å®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆç‰©ç†ç’°å¢ƒï¼‰
2. **controller-pid** - PIDåˆ¶å¾¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
3. **controller-mpc** - ãƒ¢ãƒ‡ãƒ«äºˆæ¸¬åˆ¶å¾¡ï¼ˆMPCï¼‰
4. **controller-vla** - Vision-Language-Actionåˆ¶å¾¡ï¼ˆå¼·åŒ–å­¦ç¿’ï¼‰
5. **metrics-calculator** - åˆ¶å¾¡æ€§èƒ½æŒ‡æ¨™ã®è‡ªå‹•è¨ˆç®—
6. **visualization** - Streamlitå¯è¦–åŒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

### VLAæ”¯æ´ã‚µãƒ¼ãƒ“ã‚¹

7. **redis** - ç”»åƒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
8. **image-generator** - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã®å¯è¦–åŒ–ç”»åƒç”Ÿæˆ
9. **data-collector** - å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åŽé›†ãƒ»ä¿å­˜

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```mermaid
graph TB
    subgraph "Simulation Core"
        SR[sim-runner] -->|Read| INP[Net1.inp]
        SR -->|Write| RES[result.csv]
    end
    
    subgraph "Controllers"
        SR -->|HTTP POST| PID[controller-pid]
        SR -->|HTTP POST| MPC[controller-mpc]
        SR -->|HTTP POST| VLA[controller-vla]
        PID -->|Action| SR
        MPC -->|Action| SR
        VLA -->|Delta Action| SR
    end
    
    subgraph "VLA Infrastructure"
        VLA -->|Generate| IMG[image-generator]
        IMG -->|Cache| REDIS[(Redis)]
        VLA -->|Collect| DC[data-collector]
        DC -->|Save| TD[training_data/]
    end
    
    subgraph "Analysis & Viz"
        MET[metrics-calculator] -->|Watch| RES
        MET -->|Generate| M_CSV[metrics.csv]
        VIZ[visualization] -->|Read| RES
        VIZ -->|Read| M_CSV
    end
```

---

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶

- Docker Compose ã¾ãŸã¯ Podman Compose
- `shared/networks/Net1.inp` (EPANETã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«)

### 1. PIDåˆ¶å¾¡ã®å®Ÿè¡Œï¼ˆåœ§åŠ›åˆ¶å¾¡ï¼‰

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: PIDåœ§åŠ›åˆ¶å¾¡
docker-compose up --build
```

### 2. MPCåˆ¶å¾¡ã®å®Ÿè¡Œ

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > .env << 'EOF'
EXP_ID=exp_mpc_001
EXP_CONFIG_FILE=exp_mpc.json
CONTROLLER_HOST=controller-mpc
EOF

docker-compose up --build
```

### 3. VLAåˆ¶å¾¡ã®å®Ÿè¡Œ

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > .env << 'EOF'
EXP_ID=simplednn_001
EXP_CONFIG_FILE=exp_vla.json
CONTROLLER_HOST=controller-vla
VLA_MODEL=simple_dnn
EOF

# VLAé–¢é€£ã‚µãƒ¼ãƒ“ã‚¹ã‚‚èµ·å‹•
docker-compose up --build
```

### 4. çµæžœã®ç¢ºèª

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:8501 ã«ã‚¢ã‚¯ã‚»ã‚¹

---

## ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°

### 1. sim-runner (ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³)

**å½¹å‰²**: ç‰©ç†ç’°å¢ƒï¼ˆé…æ°´ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**ä¸»ãªæ©Ÿèƒ½**:
- EPANETãƒ¢ãƒ‡ãƒ«ï¼ˆ.inpï¼‰ã®èª­ã¿è¾¼ã¿ã¨å®Ÿè¡Œ
- æ°´ç†è¨ˆç®—ï¼ˆåœ§åŠ›ã€æµé‡ï¼‰ã®å®Ÿæ–½
- ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¸ã®é€ä¿¡
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã®åˆ¶å¾¡æŒ‡ä»¤ï¼ˆãƒãƒ«ãƒ–é–‹åº¦ï¼‰ã®é©ç”¨
- çµæžœã®CSVå‡ºåŠ›ï¼ˆresult.csvï¼‰

**å®Ÿè£…**: `/sim-runner/main.py`

**å…¥åŠ›**:
- EPANET INPãƒ•ã‚¡ã‚¤ãƒ« (`shared/networks/*.inp`)
- è¨­å®šJSON (`shared/configs/*.json`)
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã®HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹

**å‡ºåŠ›**:
- `result.csv` - ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæžœ

**æŽ¥ç¶šå…ˆ**:
- controller-pid / controller-mpc / controller-vla (HTTP POST)

---

### 2. controller-pid (PIDåˆ¶å¾¡)

**å½¹å‰²**: å¤å…¸çš„PIDåˆ¶å¾¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æä¾›

**ä¸»ãªæ©Ÿèƒ½**:
- ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å—ä¿¡
- PIDè¨ˆç®—ï¼ˆæ¯”ä¾‹ãƒ»ç©åˆ†ãƒ»å¾®åˆ†ï¼‰
- ãƒãƒ«ãƒ–é–‹åº¦ã®æ±ºå®š
- è¤‡æ•°ãƒ«ãƒ¼ãƒ—ã®ç‹¬ç«‹åˆ¶å¾¡

**å®Ÿè£…**: `/controller-pid/app.py`

**API**:
- `POST /control` - åˆ¶å¾¡è¨ˆç®—
- `GET /status` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
- `POST /reset` - ãƒªã‚»ãƒƒãƒˆ

**å…¥åŠ›**:
```json
{
  "sensor_data": [
    {
      "loop_id": "loop_1",
      "pressure": 127.5,
      "target": 120.0,
      "prev_action": 1.0
    }
  ]
}
```

**å‡ºåŠ›**:
```json
{
  "actions": [
    {
      "loop_id": "loop_1",
      "action": 1.05,
      "p_term": 0.15,
      "i_term": 0.02,
      "d_term": -0.01,
      "error": 7.5
    }
  ]
}
```

---

### 3. controller-mpc (ãƒ¢ãƒ‡ãƒ«äºˆæ¸¬åˆ¶å¾¡)

**å½¹å‰²**: äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã‚’ç”¨ã„ãŸæœ€é©åˆ¶å¾¡

**ä¸»ãªæ©Ÿèƒ½**:
- ä¸€æ¬¡é…ã‚Œç³»ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹äºˆæ¸¬
- ãƒ›ãƒ©ã‚¤ã‚¾ãƒ³å†…ã§ã®æœ€é©åŒ–è¨ˆç®—
- åˆ¶ç´„æ¡ä»¶ã®è€ƒæ…®
- è¤‡æ•°ãƒ«ãƒ¼ãƒ—ã®ç‹¬ç«‹åˆ¶å¾¡

**å®Ÿè£…**: `/controller-mpc/app.py`

**API**: controller-pidã¨åŒã˜å½¢å¼

**ç‰¹å¾´**:
- ãƒ¢ãƒ‡ãƒ«ãƒ™ãƒ¼ã‚¹ã®äºˆæ¸¬åˆ¶å¾¡
- ç›®çš„é–¢æ•°ã®æœ€å°åŒ–
- åˆ¶ç´„ã®æ˜Žç¤ºçš„ãªæ‰±ã„

---

### 4. controller-vla (Vision-Language-Actionåˆ¶å¾¡)

**å½¹å‰²**: ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã¨ã™ã‚‹å¼·åŒ–å­¦ç¿’ãƒ™ãƒ¼ã‚¹ã®åˆ¶å¾¡

**ä¸»ãªæ©Ÿèƒ½**:
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ç”»åƒã®å–å¾—
- VLAãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹è¡Œå‹•æŽ¨è«–
- SACï¼ˆSoft Actor-Criticï¼‰ã«ã‚ˆã‚‹å­¦ç¿’
- ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰çµ±è¨ˆã®è¨ˆç®—ãƒ»ä¿å­˜

**å®Ÿè£…**: `/controller-vla/`
- `app.py` - Flaskã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- `training/controller.py` - VLAController
- `models/simple_dnn.py` - SimpleDNN VLAãƒ¢ãƒ‡ãƒ«
- `agents/sac_agent.py` - SACå­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

**API**:
- `POST /control` - åˆ¶å¾¡è¨ˆç®—ï¼ˆå€‹åˆ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰

**å…¥åŠ›**:
```json
{
  "loop_id": "loop_1",
  "pressure": 127.5,
  "target": 120.0,
  "prev_action": 1.0,
  "step": 0,
  "time_step": 0
}
```

**å‡ºåŠ›**:
```json
{
  "delta_action": 0.015
}
```

**å­¦ç¿’ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›**:
- `training_steps.csv` - ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã®è©³ç´°ãƒ­ã‚°
- `training_episodes.csv` - ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰çµ±è¨ˆ

**ä¾å­˜ã‚µãƒ¼ãƒ“ã‚¹**:
- redisï¼ˆç”»åƒã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
- image-generatorï¼ˆç”»åƒç”Ÿæˆï¼‰
- data-collectorï¼ˆãƒ‡ãƒ¼ã‚¿åŽé›†ï¼‰

---

### 5. redis (ç”»åƒã‚­ãƒ£ãƒƒã‚·ãƒ¥)

**å½¹å‰²**: VLAåˆ¶å¾¡ç”¨ã®ç”»åƒãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

**ä¸»ãªæ©Ÿèƒ½**:
- ç”Ÿæˆã•ã‚ŒãŸç”»åƒã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ä¿å­˜
- é«˜é€Ÿãªç”»åƒå–å¾—
- æ®ç™ºæ€§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆå†èµ·å‹•ã§ã‚¯ãƒªã‚¢ï¼‰

**å®Ÿè£…**: Rediså…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆredis:7-alpineï¼‰

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ **:
```
key: {exp_id}:step_{step}:{image_type}
value: PNGç”»åƒã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿
```

**ä¾‹**:
```
simplednn_001:step_0:system_ui
simplednn_001:step_0:valve_detail
simplednn_001:step_0:flow_dashboard
simplednn_001:step_0:comparison
```

---

### 6. image-generator (ç”»åƒç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹)

**å½¹å‰²**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã®å¯è¦–åŒ–ç”»åƒã‚’ç”Ÿæˆ

**ä¸»ãªæ©Ÿèƒ½**:
- 4ç¨®é¡žã®å¯è¦–åŒ–ç”»åƒã®ç”Ÿæˆ
  - `system_ui`: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®UI
  - `valve_detail`: ãƒãƒ«ãƒ–è©³ç´°
  - `flow_dashboard`: æµé‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
  - `comparison`: ç›®æ¨™å€¤ã¨ã®æ¯”è¼ƒ
- Redisã¸ã®ç”»åƒä¿å­˜

**å®Ÿè£…**: `/image-generator/app.py`

**API**:
- `POST /generate` - ç”»åƒç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ

**å…¥åŠ›**:
```json
{
  "exp_id": "simplednn_001",
  "step": 0,
  "state": {
    "pressure": 127.5,
    "target": 120.0,
    "valve_setting": 1.0
  }
}
```

**å‡ºåŠ›**:
```json
{
  "status": "success",
  "redis_keys": {
    "system_ui": "simplednn_001:step_0:system_ui",
    "valve_detail": "simplednn_001:step_0:valve_detail",
    "flow_dashboard": "simplednn_001:step_0:flow_dashboard",
    "comparison": "simplednn_001:step_0:comparison"
  }
}
```

---

### 7. data-collector (ãƒ‡ãƒ¼ã‚¿åŽé›†ã‚µãƒ¼ãƒ“ã‚¹)

**å½¹å‰²**: VLAå­¦ç¿’ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç”Ÿæˆ

**ä¸»ãªæ©Ÿèƒ½**:
- çŠ¶æ…‹ãƒ»è¡Œå‹•ãƒ»å ±é…¬ã®è¨˜éŒ²
- ç”»åƒå‚ç…§ï¼ˆRedisã‚­ãƒ¼ï¼‰ã®ä¿å­˜
- JSONå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**å®Ÿè£…**: `/data-collector/app.py`

**API**:
- `POST /collect` - ãƒ‡ãƒ¼ã‚¿åŽé›†ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

**å…¥åŠ›**:
```json
{
  "exp_id": "simplednn_001",
  "step": 0,
  "time_step": 0,
  "state": {
    "pressure": 127.5,
    "target": 120.0
  },
  "action": {
    "delta_action": 0.015
  },
  "reward": -0.5,
  "images": {
    "system_ui": "simplednn_001:step_0:system_ui"
  }
}
```

**å‡ºåŠ›å…ˆ**:
```
shared/training_data/{exp_id}/
â”œâ”€â”€ step_000000.json
â”œâ”€â”€ step_000001.json
â”œâ”€â”€ ...
â””â”€â”€ metadata.json
```

---

### 8. metrics-calculator (ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®—ã‚µãƒ¼ãƒ“ã‚¹)

**å½¹å‰²**: åˆ¶å¾¡æ€§èƒ½æŒ‡æ¨™ã®è‡ªå‹•è¨ˆç®—

**ä¸»ãªæ©Ÿèƒ½**:
- result.csvã®ç›£è¦–ï¼ˆ5ç§’ã”ã¨ã®ãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰
- ãƒ«ãƒ¼ãƒ—ã”ã¨ã®æ€§èƒ½æŒ‡æ¨™è¨ˆç®—
- å…¨ä½“çµ±åˆæŒ‡æ¨™ã®è¨ˆç®—
- metrics.csvã®è‡ªå‹•ç”Ÿæˆ

**å®Ÿè£…**: `/metrics/analyze.py`

**è¨ˆç®—æŒ‡æ¨™**:
- MAE, RMSE, MaxError
- IAE, ISE
- SteadyMAE, SteadyRMSE
- TotalVariationï¼ˆãƒãƒ«ãƒ–æ“ä½œé‡ï¼‰

**å…¥åŠ›**: `result.csv`

**å‡ºåŠ›**: `metrics.csv`

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. result.csvã‚’æ¤œå‡º
2. ãƒ«ãƒ¼ãƒ—ã”ã¨ã«æŒ‡æ¨™ã‚’è¨ˆç®—
3. å…¨ä½“çµ±åˆæŒ‡æ¨™ã‚’è¨ˆç®—
4. metrics.csvã«ä¿å­˜

---

### 9. visualization (å¯è¦–åŒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰)

**å½¹å‰²**: Streamlitãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªå¯è¦–åŒ–

**ä¸»ãªæ©Ÿèƒ½**:
- 3Dãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¯è¦–åŒ–
- åˆ¶å¾¡æ€§èƒ½ã‚°ãƒ©ãƒ•
- æ™‚ç³»åˆ—åˆ†æž
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¡¨ç¤º

**å®Ÿè£…**: `/visualization/`
- `app.py` - ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
- `tabs/` - å„ã‚¿ãƒ–ã®å®Ÿè£…
- `utils/` - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

**ã‚¢ã‚¯ã‚»ã‚¹**: http://localhost:8501

**ã‚¿ãƒ–æ§‹æˆ**:
1. **Network 3D**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒãƒ­ã‚¸ãƒ¼
2. **Control Performance**: åˆ¶å¾¡è¿½å¾“æ€§èƒ½
3. **Time Series**: ã‚«ã‚¹ã‚¿ãƒ æ™‚ç³»åˆ—åˆ†æž
4. **Metrics**: æ€§èƒ½æŒ‡æ¨™ã‚µãƒžãƒªãƒ¼

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### PID/MPCåˆ¶å¾¡ã®å ´åˆ

```
[sim-runner]
    â”‚
    â”œâ”€ 1. ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿èª­å–
    â”‚     (åœ§åŠ›ã€æµé‡)
    â”‚
    â”œâ”€ 2. HTTP POST
    â”‚     â†“
    [controller-pid/mpc]
    â”‚     â”‚
    â”‚     â”œâ”€ PID/MPCè¨ˆç®—
    â”‚     â”‚
    â”‚     â””â”€ 3. ãƒãƒ«ãƒ–é–‹åº¦
    â”‚           â†“
    [sim-runner]
    â”‚     â”‚
    â”‚     â”œâ”€ 4. ãƒãƒ«ãƒ–é–‹åº¦é©ç”¨
    â”‚     â”œâ”€ 5. æ°´ç†è¨ˆç®—å®Ÿè¡Œ
    â”‚     â””â”€ 6. result.csvå‡ºåŠ›
    â”‚           â†“
    [metrics-calculator]
    â”‚     â”‚
    â”‚     â””â”€ 7. metrics.csvç”Ÿæˆ
    â”‚           â†“
    [visualization]
          â”‚
          â””â”€ 8. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
```

### VLAåˆ¶å¾¡ã®å ´åˆ

```
[sim-runner]
    â”‚
    â”œâ”€ 1. ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿èª­å–
    â”‚     (åœ§åŠ›ã€æµé‡)
    â”‚
    â”œâ”€ 2. HTTP POST
    â”‚     â†“
    [controller-vla]
    â”‚     â”‚
    â”‚     â”œâ”€ 3. ç”»åƒç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    â”‚     â”‚     â†“
    â”‚     [image-generator]
    â”‚     â”‚     â”‚
    â”‚     â”‚     â”œâ”€ ç”»åƒç”Ÿæˆ
    â”‚     â”‚     â”‚   (system_ui, valve_detail,
    â”‚     â”‚     â”‚    flow_dashboard, comparison)
    â”‚     â”‚     â”‚
    â”‚     â”‚     â””â”€ 4. Redisä¿å­˜
    â”‚     â”‚           â†“
    â”‚     â”‚     [redis]
    â”‚     â”‚
    â”‚     â”œâ”€ 5. ç”»åƒå–å¾—ï¼ˆRedisï¼‰
    â”‚     â”œâ”€ 6. VLAãƒ¢ãƒ‡ãƒ«æŽ¨è«–
    â”‚     â”‚     (SimpleDNN/OpenVLA)
    â”‚     â”œâ”€ 7. SACå­¦ç¿’
    â”‚     â”‚
    â”‚     â”œâ”€ 8. ãƒ‡ãƒ¼ã‚¿åŽé›†ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    â”‚     â”‚     â†“
    â”‚     [data-collector]
    â”‚     â”‚     â”‚
    â”‚     â”‚     â””â”€ 9. JSONä¿å­˜
    â”‚     â”‚           (training_data/)
    â”‚     â”‚
    â”‚     â””â”€ 10. delta_actionè¿”å´
    â”‚           â†“
    [sim-runner]
    â”‚     â”‚
    â”‚     â”œâ”€ 11. ãƒãƒ«ãƒ–é–‹åº¦æ›´æ–°
    â”‚     â”‚      (current + delta)
    â”‚     â”œâ”€ 12. æ°´ç†è¨ˆç®—å®Ÿè¡Œ
    â”‚     â””â”€ 13. result.csvå‡ºåŠ›
    â”‚           â†“
    [controller-vla]
    â”‚     â”‚
    â”‚     â””â”€ 14. training_steps.csv
    â”‚            training_episodes.csvç”Ÿæˆ
    â”‚           â†“
    [metrics-calculator]
    â”‚     â”‚
    â”‚     â””â”€ 15. metrics.csvç”Ÿæˆ
    â”‚           â†“
    [visualization]
          â”‚
          â””â”€ 16. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
```

---

## ãƒãƒ¼ãƒˆå‰²ã‚Šå½“ã¦

| ã‚µãƒ¼ãƒ“ã‚¹ | ãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒˆ | ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆ | ãƒ—ãƒ­ãƒˆã‚³ãƒ« |
|:---|:---:|:---:|:---|
| controller-pid | 5000 | 5000 | HTTP |
| controller-mpc | 5001 | 5000 | HTTP |
| controller-vla | 5002 | 5000 | HTTP |
| image-generator | 5003 | 5000 | HTTP |
| data-collector | 5004 | 5000 | HTTP |
| redis | 6379 | 6379 | Redis |
| visualization | 8501 | 8501 | HTTP |

---

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- ðŸ“– **[è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°](docs/CONFIGURATION.md)** - å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¬æ˜Žã¨ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰
- ðŸŽ® **[ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼è©³ç´°](docs/CONTROLLERS.md)** - PIDã€MPCã€VLAã®å®Ÿè£…ã¨ä½¿ã„æ–¹
- ðŸ¤– **[VLAã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰](docs/VLA_SETUP.md)** - Vision-Language-Actionåˆ¶å¾¡ã®è©³ç´°
- ðŸ“Š **[ãƒ¡ãƒˆãƒªã‚¯ã‚¹è©³ç´°](docs/METRICS.md)** - æ€§èƒ½è©•ä¾¡æŒ‡æ¨™ã®èª¬æ˜Ž
- ðŸ“ˆ **[å¯è¦–åŒ–ã‚¬ã‚¤ãƒ‰](docs/VISUALIZATION.md)** - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ä½¿ã„æ–¹
- ðŸ› ï¸ **[é–‹ç™ºã‚¬ã‚¤ãƒ‰](docs/DEVELOPMENT.md)** - æ–°æ©Ÿèƒ½è¿½åŠ ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

---

## åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼

ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«ä»¥ä¸‹ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ï¼š

1. **Sense (è¦³æ¸¬)** - ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆåœ§åŠ›ã€æµé‡ï¼‰
2. **Decide Request (æ„æ€æ±ºå®šè¦æ±‚)** - ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¸HTTP POST
3. **Control Calculation (åˆ¶å¾¡è¨ˆç®—)** - æœ€é©ãªæ“ä½œé‡ã‚’è¨ˆç®—
4. **Actuate (æ“ä½œ)** - ãƒãƒ«ãƒ–é–‹åº¦ã‚’EPANETãƒ¢ãƒ‡ãƒ«ã«é©ç”¨

### ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼åˆ¥ã®ç‰¹å¾´

| ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ | å…¥åŠ› | å‡ºåŠ› | å­¦ç¿’ | ç”¨é€” |
|:---|:---|:---|:---|:---|
| **PID** | åœ§åŠ›/æµé‡ | ãƒãƒ«ãƒ–é–‹åº¦ | ãªã— | å˜ç´”ãªåˆ¶å¾¡å•é¡Œ |
| **MPC** | åœ§åŠ›/æµé‡ | ãƒãƒ«ãƒ–é–‹åº¦ | ãªã— | äºˆæ¸¬åˆ¶å¾¡ãƒ»åˆ¶ç´„ã‚ã‚Š |
| **VLA** | ç”»åƒ+ãƒ†ã‚­ã‚¹ãƒˆ | ãƒãƒ«ãƒ–é–‹åº¦å¤‰åŒ– | ã‚ã‚Š | è¤‡é›‘ãªè¦–è¦šçš„åˆ¤æ–­ |

---

## å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿

### result.csv
å„ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæžœ

### metrics.csv
åˆ¶å¾¡æ€§èƒ½ã®è©•ä¾¡æŒ‡æ¨™ï¼ˆMAEã€RMSEã€IAEã€ISEç­‰ï¼‰

### training_episodes.csvï¼ˆVLAã®ã¿ï¼‰
ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã”ã¨ã®å­¦ç¿’çµ±è¨ˆ

### training_steps.csvï¼ˆVLAã®ã¿ï¼‰
ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã®è©³ç´°ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ­ã‚°

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
.
â”œâ”€â”€ README.md                 # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ docs/                     # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ CONFIGURATION.md
â”‚   â”œâ”€â”€ CONTROLLERS.md
â”‚   â”œâ”€â”€ VLA_SETUP.md
â”‚   â”œâ”€â”€ METRICS.md
â”‚   â”œâ”€â”€ VISUALIZATION.md
â”‚   â””â”€â”€ DEVELOPMENT.md
â”œâ”€â”€ controller-pid/           # PIDåˆ¶å¾¡
â”œâ”€â”€ controller-mpc/           # MPCåˆ¶å¾¡
â”œâ”€â”€ controller-vla/           # VLAåˆ¶å¾¡ï¼ˆå¼·åŒ–å­¦ç¿’ï¼‰
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ models/               # VLAãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ training/             # å­¦ç¿’ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ sim-runner/               # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
â”œâ”€â”€ image-generator/          # ç”»åƒç”Ÿæˆ
â”œâ”€â”€ data-collector/           # ãƒ‡ãƒ¼ã‚¿åŽé›†
â”œâ”€â”€ metrics/                  # ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®—
â”œâ”€â”€ visualization/            # å¯è¦–åŒ–
â””â”€â”€ shared/                   # å…±æœ‰ãƒ‡ãƒ¼ã‚¿
    â”œâ”€â”€ configs/              # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
    â”œâ”€â”€ networks/             # EPANETãƒ¢ãƒ‡ãƒ«
    â”œâ”€â”€ results/              # å®Ÿé¨“çµæžœ
    â””â”€â”€ training_data/        # å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ï¼ˆVLAï¼‰
```

---

## å¤‰æ›´å±¥æ­´

### v3.0.0 (2025-12-01)
- âœ¨ VLA (Vision-Language-Action) ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®è¿½åŠ 
- âœ¨ ç”»åƒç”Ÿæˆãƒ»ãƒ‡ãƒ¼ã‚¿åŽé›†ã‚µãƒ¼ãƒ“ã‚¹ã®è¿½åŠ 
- âœ¨ ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰çµ±è¨ˆã®è‡ªå‹•è¨ˆç®—
- ðŸ”§ sim-runnerã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—è‡ªå‹•åˆ¤å®š
- ðŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®åˆ†å‰²ãƒ»æ•´ç†

### v2.0.0 (2025-11-23)
- æµé‡åˆ¶å¾¡ãƒ¢ãƒ¼ãƒ‰ã®è¿½åŠ 
- è¤‡æ•°ãƒ«ãƒ¼ãƒ—ï¼ˆåˆ†æ•£åˆ¶å¾¡ï¼‰ã®å¯¾å¿œ
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®—ã®æ‹¡å¼µ

### v1.0.0 (åˆç‰ˆ)
- åŸºæœ¬çš„ãªåœ§åŠ›åˆ¶å¾¡ï¼ˆå˜ä¸€ãƒ«ãƒ¼ãƒ—ï¼‰
- PID/MPC ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©